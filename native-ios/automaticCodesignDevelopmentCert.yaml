# Prerequisites:
# a) access to App Store Connect -> Users and Access -> Keys
# b) devices added to your Apple Developer Account

# FILL-IN GUIDE:
# APP_STORE_CONNECT_ISSUER_ID: App Store Connect -> Users and Access -> Keys -> Issuer ID (format: 35f1fg2-5abe-17cd-9d15-3fd7g62d7a4a)
# APP_STORE_CONNECT_KEY_IDENTIFIER: App Store Connect -> Users and Access -> Keys (+ to add new key) -> key ID once process completed
# NB! When generating a new key choose either Developer or App Manager access.
# APP_STORE_CONNECT_PRIVATE_KEY: Download the previously created key in App Store Connect -> Users and Access -> Keys -> Download API Key
# after you've downloaded the key, open it up in any of your editors, and copy the CONTENT of the key to the Codemagic encryption tool
# make sure that you include the entire document, including -----BEGIN PRIVATE KEY----- and -----END PRIVATE KEY-----, once encrypted
# go ahead and paste the value into the yaml.
# CERTIFICATE_PRIVATE_KEY: generate a new key locally using: ssh-keygen -t rsa -b 2048 -m PEM -f ~/Desktop/codemagic_private_key -q -N ""
# after the key has been generated, copy the entire CONTENT of the file (codemagic_private_key), including -----BEGIN RSA PRIVATE KEY----- and
# -----END RSA PRIVATE KEY----- and the following empty line into the Codemagic encryption tool and paste the encrypted value into the yaml. 
# XCODE_WORKSPACE: this is simply the name of your .xcworkspace, thus for example: appname.xcworkspace.
# XCODE_PROJECT: this can be defined instead of XCODE_WORKSPACE, to use your appname.xcodeproj file instead.
# NB! If you decide to use .xcodeproj instead of .xcworkspace, please also modify the build-ipa script accordingly.
# XCODE_SCHEME: this is your xcode scheme/target name, which by default most likely is your app name.
# Add your bundle ID to the app-store-connect fetch step!

# Video example of filling in the values with real information:
# https://www.youtube.com/watch?v=ymoirZuH10U

workflows:
  ios:
    name: iOS automatic code signing with developer certificate
    max_build_duration: 60
    environment:
      vars:
        APP_STORE_CONNECT_ISSUER_ID: 7d812fe2-8abd-47ca-9d27-3ed7e62d7b6d
        APP_STORE_CONNECT_KEY_IDENTIFIER: QN763V2544
        APP_STORE_CONNECT_PRIVATE_KEY: Encrypted(Z0FBQUFBQmZrbzVud2g5NHdJR00wQkJ2SlBlVU1JcjNJT2ktRnVvQ1lZNDBuU1Zjc3JaOWNTZnBoSVc5S3BWdmxaZ2FyVjFNZ3hrdE5qUVZhLWlfSF8xcGhGdDVnY3RSLUFFSXdYUk9qYjl4NmNWREh3Wk9Ba1FDWkhBQ29YN2t2VnJtVVhOaHNEUHVFbl9aYjZHZkhERG9XN2dvNUcyUzF2eTlsQnlRUnRNQWhzMmJaOHhOWWtINS1BanFkbXJFelNBMTNrc28zcGRDT3M2Ml9yMmRxWS1DYXB4ZW13eVl6VFVIOEFhb1NydDR3SnZCbkVIbHlEbnVvQXFHdkFUd1g5MlZOVTJqRU9GSmRWaWI1SWZqTmNkVTd0eEQ5WFpia0xRRGxuVzhmOVM0TVIzSndYclJUVl9BS29RUTdlaE8yX1FKaXBtek5pa0F4dDQ2eXhoZTZEYzZnc0VLbGl2aTd3UGZGQXhocmw2eDBvX2NfeEthMDEzZE1BMURyeWUzWnVOWXdWb18xMlhMOVNMS2dXRjBjOUlsWUlWRnV1a0JDY01EVm5RQXRUb2xiTGszcENzalRNaz0=)
        CERTIFICATE_PRIVATE_KEY: Encrypted(Z0FBQUFBQmZrbzZOVk1zU1hjT1c5cjZRbmlFUEtUODYwVGp4b0dONjdxcHhnNzBkbUtRTVQ3eWhRMEozck5maXFTa1FIb3NEaVhlT242bk5MLXJ6QmlSZlNpSzFvcV9hNFFxZ1RoQ1pjb19Rd3hrQW5yYUhfbkpGaU81ajVyZlVidU9ldm5JUjFLOGw1VGxRSGp6cTg0cG5CYWlIZ1g3aUhrMjFHOFZ6UU5ZeGc1aURycko3UU9RRUhPNUtnNjRtVzNBSjFldk5tSW9qWFlQYnFXLVlDRHZ4OEpIMW1kcjRJUENybkhhZ1YtbU5pSmZFUE9FVWF1eXFucFpMa2lMQ2tCTjRxZXN0bUg0UXgyTlBiVVlhYlFhNVQtMTVFUUxzSWtySVlGNnZIdk5OVVF5QUxMdmFZenRpemN5QjRDdklHWVhNU2xzYkpQQ04wWThyTTdZcDlvelBNVWdaWHhxWXhGLTduY3ZBamI3dFk5RGEyaHlQQm5ZbnU1d2M3Rk9zTndiR1ZXb3BxQWNpODRWUXFfX0x2bk5EVHJWbDdLdVNqY1l3Zlo5aGJ2aEVITFMtUk9kdk1pYVFSeFBzblpncmV6TUJ6TVZXVmpkeGhEMWZ2dlhRZ3EwREl3OUppTnVCTjRSaTlMeXJpYk9KUlhMem56S0Z4dkdFdWRBT1l0MEJhb0tOeDlicEt2N3VfVDhxS05ZVUFjOGZPbWRRcm9KS2xNUjEyMmY1T2tIS3BtY1RxcGNrVjM2ZmV2Yi1obHNHcXR5TVBBWGc3dzEzODY2UGtwRVM5WjZhanl4Wi1vbHZCZFFhRTJmTF9IdmdPQmZrOF8zRTh1bzRUakFfMjhvM1VOdWUwR0VhUnV0NlUwT3EtN0k1UzlZNDY0Rms2aHk4NFlQQU8yY1NjMV9jN0lmLXVmZjJmdW9LS0ppeTR0Q09HRmRCUkkySHJNaGRrcElVdmxjcDk4OVJNV0hpa2ItX1dheFh1S2k2eVNNR1FiYl9Yc3VkWlQ2czN6bFM2X3FFajYxWEJMQmduam5GYkxlSjRLVnpoTThVb1BEZE1ndGNRTmJ0OGZ4ZmR3d1l0U3VzZWt5aFdQNXVqX2RfQmNoUkxwUjB5TXdNU3RNVndRVHc2Z21sS3JDekxReU9lUjdHVkE0N2sybE9lRUNWeVluenVOcThYX0lmb3NiMnI5X3N2Si1teS03S2hCWmtHT0I1dkQ1YXpncm9VckdpUTFndTZ5WGFSemdKTERpMHFRT0ZSeGN5VDBNVEdkSEI4QVZ0ZjNHcjdzR2FGMDBYNGVEbHBWM1FfN0hPbDVnbEFST1VqVWxBMG5uOURLeXE5ZkVoSlJheUJuT0gyclRCelRDYmtRa1A3OUtEcFZ6Y3llQmhOQ2ctWmV4MzA4a1lYMkdodXQ1LVA4anc1SWZlSWlzclhHVE4yQVhiaERtaW04elZUSVZYeXQ3M3Z5LUR1SEktLXlLUE9UOEE0M0ZuLUdWZXRpWGZRNWhreHRnbTI5aW9MNzcxUVRWZEg5dTlkeVo0VFFjM0tfWjJhZmliclk2U2t2Xzh3SDg2aHZvZzNzaXdmU1VLRVpRWDFmdmtaLVhweE9iVm40ZF9KRHhhaVdUS2RNSTdWdURHOGtPS2piTm43Q0ZsSzg1M1VfUWY3NmhfRjhyVGxvdndyZmtTU2o2UlFDYUtiLUhHd2tJUjBNVkh1UHBmTjhtQjNVbWFOVWpRbGpJc2dBdi12WDF6RjlKcTlaTF9FaTZTWTViWEtWODNvRUtJcjFYeTdWa1dFd3VoeWdyNUpJZkZ0dzZ1aWZITkZ6QWtzMlpjU1FxbEg3WUl6Rmc2djJybnNMZllfa091MDFyX1REc3hKUHNUSkl4MFZGS045YU9pMzc2RC1HRHI5SGlnSUtUVEczLVZUeVhKeEpLcWdNLWZwTEo5bEhMdF9EVHdTeUJyYmc1cHRNN0ZXYnlmN3A4VHhvU1R0Mk1qVnhBelluOWF3SlRMdUhWZWQ1Y3BveGg4dHJQajVBWldyTEhmTE8wZ1Q4LWpIb1hYYVdXcDlyZ1gzaTQ5SVdiVjN3Z1J6LWRtMlZ4b0lMNUsweTg4VW1XOUlIdExrVERjM094Z2syREpxc0p4d1Btak9OVEpjZ0VBNkxabVhDcm41cUN1dmZ6RmtOVlpKd3QyRGJsOHVGRFV4dExvUDF3ejczUllidDRyR2g1S2R3bjhQeGRYTmZhWm9WME5SZzJvUkFIbU51dmZfbzBIZFFHZ0dzNW0wcEpaVURKWVQ3RFVHdU1rSlpuRHRtdkRFTjZQdVhSLV83bDhLbzlraHpuRmlxREpYdHF5OUlxd3Y2Z0MycUFWWW9vbnpFQzNzcVZIdGVYajhvMXdjWDdTNi1tN3pXeGxaNlVpTkZ0Q1BodVR5QWJfYm1ielE2M0hfU0daVmRaQWdaRkxibFU4Tjd4ZUIwWHo2RTQ1cGN5WWV6anBmS2RQRzgwMVdva3RiLXBYc1hXZTZDZ0F3RzJPNVQ0Q29TWXV0cUJvRWpwZjQzOWh4QklHeEhCaE5HUUtYT0lEc1pLVFpYMFZ5NnljVXhPclpSNHE5dG1STm1CVG9vR1FEakdnRFBoVDE2UVJXQTdGSmFWOEZ4YWNRbXZUS3plYmthSno4MUpxZ0hpdnhTVDVlbHgwUlBVc0ZqUmNSS1UyNFdUSWdsSVBKYjlmSXc0Ny1rNHh5cVN5dHNNU0ZkaTV5X1I5YXJmbEhzUElIRjBhT2JYcFZzZzZUQWQ0RWRocWllb2ZZckYwMFEzOXFvbDRoZTdYOTR5SFNVX3lXbjM0M3ZZU1Ata3FONzNxZ2J5TFJicEY3Y0RKYm90emNJRnZGRjVNNmZ4Ync4REVUd044QWVFZU5KUGdNRFFnTHAxYVJDMm9VMUNQWG9oVXdaRGdhYzNqc2tSX3N2RWJwME1xTFNkR3BBaGtvZDVYRkZXQnJJdktaSDQ5TDdGbDVfMllLSDF6cUJPcGFiejM0dHljNmYzRUZicDFSQlNBUk13WkpTTGk0M3kwTkZKNDllR3d3U1dWZHFfd3Fad0o0T2ZpQmxVREFxSWIyTUc1)
        XCODE_WORKSPACE: exampleApp.xcworkspace
        # define XCODE_PROJECT: <your_project> if you wish to use .xcodeproj instead of .xcworkspace
        XCODE_SCHEME: exampleApp
      flutter: stable
      xcode: latest
      cocoapods: default
    scripts:
      - find . -name "Podfile" -execdir pod install \;
      - keychain initialize
      - app-store-connect fetch-signing-files "com.codemagic.exampleApp" --type IOS_APP_DEVELOPMENT --create
      - keychain add-certificates
      - xcode-project use-profiles
      - xcode-project build-ipa --workspace "$XCODE_WORKSPACE" --scheme "$XCODE_SCHEME" # use --project "$XCODE_PROJECT" instead if you wish to use .xcodeproj instead
    artifacts:
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
